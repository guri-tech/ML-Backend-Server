# MLOps project
## MLOps 시스템 구축
---
### Index

- [1. 프로젝트 소개](#프로젝트-소개)

- [2. 프로젝트 구조](#프로젝트-구조)

---
# **프로젝트 소개**
- 2022.07.09 ~ 2022.09.24 동안 진행되었으며 현재 개발 종료 상태입니다.
- [MLOps level 1](https://cloud.google.com/architecture/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning#mlops_level_1_ml_pipeline_automation)를 구현하기 하기 위해 노력했습니다.
- Workflow Management인 Prefect를 사용하여 ML파이프라인을 자동화했습니다. 또한 Prefect 대시보드를 사용하여 모델 스케쥴을 지정하여 CT(Continuous Training)를 시도하였습니다.
- CI(Continuous Integration)를 시도하기 위해 git action을 사용하였습니다.
- 서비스를 위한 API는 FastAPI를 사용하였습니다.
- API를 이용한 서비스할 때 요청에 대한 응답시간을 단축하기 위해 RedisAI를 도입하였습니다.

### Langages
<div>
<img src = "https://img.shields.io/badge/Python-3.9.8-3776AB?style=style=flat-square&logo=Python&logoColor=white"/>
<!-- <img src = ""/> -->

### Tools
<div>
<img src = "https://img.shields.io/badge/RedisAI-1.2.2-DC382D?style=style=flat-square&logo=Redis&logoColor=white"/>
<img src = "https://img.shields.io/badge/Postgresql-15.0-4169E1?style=style=flat-square&logo=Postgresql&logoColor=white"/>
<img src = "https://img.shields.io/badge/FastAPI-0.85.2-009688?style=style=flat-square&logo=FastAPI&logoColor=white"/>
<img src = "https://img.shields.io/static/v1?label=MLflow&message=1.30.0&color=2496ed&labelColor=gray&style=flat&logo=data:image/png;base64,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"/>
<img src = "https://img.shields.io/static/v1?label=Prefect&message=1.3.1&color=27b1ff&labelColor=gray&style=flat&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAHsIAAB7CAW7QdT4AAASLSURBVFhH7Zd/aBxFFMff7P1IpdiEqA0osdaDCi2hYEXbXG1yMesl/mdj0iJoSsXoH/5jECGJWA9MqCj0H/8QCkJJ8A8RLFVjTpBSqEWxsUWlDWqr1ibRYCHRSHO3O/N8szdzt3f2rnOXC6nQLzzezpvd2c99Z3Z2D27qRtK20xhqQQyqZlXEVF6WJJizDp8SDgyhCwIdNnzH3zB2IsZcdUrFWhbg5u8xHKjBp5HDADjsXkE46AAQKKCLP4kUjNTWs7HJBxhVKlNFgAqsFwQMosvu8aDy4FT22ngR0zB8+zwbnXyufNCyADcjhkMXYJ/gOAiCbchCFIPz1YVLoA6MzE6zUUiwtBryujICbDmOwflG2I8CB5HAJMT1wPSxruf68GfKI3/WsSNg4Kilckkt3g13CoH7aTo30LoCsQTAdaaQNS/76l746t51Xh/bKFLscN1lHFPDl5QR4GSEXfpuk7XddfAxnsKvsnDqpllIXddtmfV5BXWKWjV8SRkBap3fan069aC1HTl2EuiXRWF0W2bZvkZdhonKAtT6YZc1cSFu7aAntIOn8VQenMwKolRdhokqAtT65XEr+dseK8o5xgn0C1M42V5RBws1u8/67PfnrZ13zSRfX+/8kYPRcDJrOF/dRFV51e1+9sUYcv6q4Ly16f6H4NdUA3z911a4vNiQv834tiXabpJ41OpQQxTVsgD3vjDUxt30AcHdXcJ1gXMO9qNxcFwOS2kHfpyvh5MzTXBpviG3D2pQjkkYXyHA3v7EI44Ec/nDnBOYB0dfCRTtdgeEQ0GwLAsYjb6UdmFqrg6S5++Di3PrCYwGQBkrAPjMy8O2w7l0LJpxLAcn3ZO1NjsOa29ZQ4DMg7SIUmZEhHPT6+DY2QhMzd5WXcC+obd2cu68IbhozsCQW4WAlKWDre1xqLt1bQaQEaCEVLABBTs1WwvHvmn88PTb9bvVLYrK6Ckmd16haWlGFPTDKURhRs8hGZyLDFQROEpzWxr/6X+za+FJNXxJGW4zEkRBKBh6N+dqGpyOOUHrafXDMcu6YgUDA1jDI11286FYbKPRRmMESPfNAGjH/KFBZaZ+IQE9MAXJ2AKzWIIFU5En7OjBnlhsUQ1rJDMH89xSMNm2H5h+CbnFqZ8AFwMBdjAddiJ7Olte67HtBTVaWTJ0UEJpx3xAfvcULDl21XX5oTWhmsjeztaBXtu+ooapSEaANHEKwBcEJQqAaXoxwEKb+no6+7vi0Tl1+bJk6CDtcX4YL/8XmOp4dfrbGXVZVVTZGvTCB5wN+YqorsymWAJl3SsElX36WKgrqiezKdZT6oFo0GvlVXJQu+OtQ79jhW4SZLVltgY9hzSIckxF/pO8WmswO7XSJQVa6J4Xq7UGNUDhuss/Pkfn9CYSiapSGjooAfxOaWDvJX2GvnS6T2zb0nRy4qjRn/FyZPQ92N330oQQPJ7/HchPoeAjyQ+OjNMp1V98SuVNsQzAz4mmbeL9d6ME94nszpy1MjIEFCmC+9hCtuOj0Xfax987fFx13Rjq7j4QVoc39T8TwL/JfZXfhOXXJQAAAABJRU5ErkJggg=="/>
<img src = "https://img.shields.io/badge/Minio-gray?style=style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIj48cGF0aCBmaWxsPSIjYzkzOTUzIiBzdHJva2U9Im51bGwiIGQ9Ik01My45NDk3NCA4OS43NDQyMVY1OC42OTE3M2gtLjI5NjM2Yy0uMjgwMDUgMC04LjIyNTQ0IDIuMDQwMzctMzEuOTMwODQgOC4yMDAwMS01LjY3MDUyIDEuNDczMzctMTAuMzQ1NTEgMi42NjA3OC0xMC4zODg3NiAyLjYzODYxLS4yMjEzNi0uMTEzMDcgMS4zMzI4LTMuMjA3OTIgMi41NjY0My01LjExMDYgMy40NjM3OS01LjM0MTggOC42OTIxOC0xMC40MjgyOSAxNS4zNjkyOC0xNC45NTI0IDcuMTkwODktNC44NzIyNSAxNi42MTkwOC05LjI2OTE1IDI2LjkzNzUtMTIuNTYyNzcgMi42MTA4NC0uODMzMzkgNi43MzA3LTIuMDE3NjggNy4wMTg5LTIuMDE3NjguMTUyNzcgMCAuMTk1NDMgMS40OTcxNy4yMjU0MyA3LjkwMzk0bC4wMzcxNCA3LjkwMzk0LjMxNDI3LjAyMjg0Yy4xNzI4Ni4wMTI2NS44NjA5Ni0uMTE3MTYgMS41MjkxMS0uMjg4NDEgNS42NzA1Mi0xLjQ1MzE0IDkuNzc3OTktNC4yNzQ0NSAxMC44MTQ0NC03LjQyODI5LjI5NTM0LS44OTkuMjk4ODMtMi41MzU4MS4wMDcyOC0zLjM5OTEtLjU5ODI1LTEuNzcwNDgtMi4xODEyNC0zLjUxMTczLTQuNDE4ODMtNC44NjA2NS0uOTU5Ny0uNTc4NjEtNC43NDI1Ny0yLjYxODM4LTExLjM4MzEyLTYuMTM4MTUtMTIuMzY2MjYtNi41NTQ1OC0xMi44NjA4Mi02Ljg0MjAyLTE0LjIwOTY0LTguMjU5MzgtLjk5MDcyLTEuMDQxMDEtMS4yNjIwMi0xLjY2NDc3LTEuMjYyMDItMi45MDEyMSAwLTEuMTY0MzUuMjM1OTItMS43NjA1MSAxLjEwMTU0LTIuNzgzMTUgMS42NDYzNC0xLjk0NTMgNS4zMDMyNC0zLjUyMDgxIDkuNDAwMDgtNC4wNDk3OS43MzM5Ny0uMDk0NzcgMS4yOTk3NC0uMTkwMTQgMS4yNTcwNy0uMjEyMDFzLjM4NjM1LS4wNjI5My45NTMyOS0uMDkxNWMxLjIxMjM2LS4wNjEgMy40NzA2NC4wMjExMyAzLjE3ODguMTE1Ni0uMTM3NjIuMDQ0NjMtLjA5MDczLjA2MzQ1LjE1OTkuMDY0MjcuNjE4MzQuMDAxOTMgMi41MTU0Ni4zMDMwNyAzLjczNDk2LjU5Mjg5IDIuNjI2NzIuNjIzOTggNC45MjU2MiAxLjYxODg4IDYuOTYxNTIgMy4wMTIzNSAxLjU2NTUyIDEuMDcxNTEgNi4zMDc1IDQuOTg3NDEgMTkuMDU3OTMgMTUuNzM3MjkgMS45MTk2OSAxLjYxODQzIDIuMTk5MjkgMi4wNTEzOC45NDg5MiAxLjQ2OTItLjI4NTcyLS4xMzI5My0zLjYxOTQ3LTEuODk4ODEtNy40MDg0Ni0zLjkyNDA3cy04LjIwNTE5LTQuMzg1MjktOS44MTM2Ny01LjI0NDUtNC4zNzQxMi0yLjM0ODg3LTYuMTQ2LTMuMzEwMzZjLTYuNTU4NzEtMy41NTkzNC03LjE1MDk4LTMuODA1MDUtOS4yOTE4OC0zLjg1NDMtMS41NzU3MS0uMDM2My0yLjU2MDg5LjE1MTAxLTMuNjQ5MTguNjkzNjktMS4zOTQ1NS42OTU1NS0xLjkxODk2IDEuNTU5OTYtMS40NDk3NCAyLjM5MDE1LjQ2NjAxLjgyNDk5LS41NDg0NC4yNDA4NyAxMi40NTA0NCA3LjE2OCA1LjQxMjc1IDIuODg0NDcgMTAuMzY2NDggNS41MzA5NyAxMS4wMDg0MSA1Ljg4MTEzIDQuMDc0MTMgMi4yMjIyNSA2LjQ5NzY5IDQuNzA5MjYgNy41NzE0MiA3Ljc2OTQ0LjMxNTI5Ljg5ODQxLjQzMjgxIDIuOTMwMjIuMjI1NTggMy44OTgzNC0uOTcyOCA0LjU0Mzk3LTUuNjEzNDMgOC4zOTQ0LTEzLjEyMzEgMTAuODg4MzItLjY4MDgyLjIyNjA3LTIuODc2MTguODQ3LTQuODc4NTggMS4zNzk4NmwtMy42NDA3My45Njg3OC0uMDM2NyAxOS4yMzU2M2MtLjAyMDEgMTAuNTc5Ni0uMDg3MDkgMTkuMjM1NjMtLjE0ODU0IDE5LjIzNTYzcy0yLjE5MTQzLTEuMDY0MDgtNC43MzI4MS0yLjM2NDU2bC00LjYyMDY3LTIuMzY0NTZ6TTM2LjE1ODQ5IDU4LjA4Njg2YzExLjc4Mzg5LTMuMDg2MjkgMTYuMjk3NjctNC4yODQ0OSAxNi44NjcwOC00LjQ3NzI0Ljk3MDA0LS4zMjg1MS45MjQwMi0uMDYzNi45MjQwMi01LjMxMDQ4IDAtNC43MjQxNC0uMDE5MzctNC45MzE3Ni0uNDYwMzMtNC45MzE3Ni0uMDYxMDIgMCA1LjUyNjc4LTIuMzYwMTctMS44Mjc2NS43MTg2OHMtMTMuODQ3ODkgNi43NDk0OC0xOC44NjMzNyAxMC42NjI5OWMtMi43NzM4IDIuMTY0NTMtNi4yMjE1OCA1LjM1OTczLTYuMDQxNTggNS41OTkyNi4wNTMxNS4wNzA4Mi4xMzY4OS4xMjg3Ny4xODYyNi4xMjg3N3M0LjE5NjMxLTEuMDc1NjEgOS4yMTU1Ny0yLjM5MDIzek0xMS4wMDA3MyA2OS42NTgwOGMuMDA2OTktLjA4NjY2LjA0MTUtLjEwNDI5LjA4Nzk2LS4wNDQ5My4wNDIwOS4wNTM2NC4wMzY4NC4xMTc4My0uMDExNS4xNDI1My0uMDQ4MzUuMDI0Ny0uMDgyNzItLjAxOTE5LS4wNzY0Ni0uMDk3NnoiLz48L3N2Zz4="/>

---

# **프로젝트 구조**

```
.
├── db
│   ├── bookings.csv
│   └── bookingscsv_to_db.py
├── environment.py
├── locustfile.py
├── main.py
├── readme.md
├── routers.py
├── schemas.py
├── static
│   └── css
│       └── styles.css
├── tasks.py
├── templates
│   ├── base.html
│   ├── index.html
│   └── result.html
├── test_api.py
├── train_flow.py
└── utils
    ├── utils.py
    └── utils_redis.py
---
### Fast API
- 파이프라인으로 관리되는 ML모델으로 입력된 정보에 대한 예측 값 제공
- API 서버에서 예측하고자 하는 값을 받으면 RedisAI에서 저장된 모델을 불러와 입력받은 값을 바탕으로 예측 실행
### MLflow
- 모델 실험 결과 관리
- prefect에서 스케쥴에 따라 갱신된 모델 혹은 하이퍼 파라미터를 새로 설정하여 실험한 모델에 대한 실험 결과를 저장
- 저장된 실험 결과를 가지고 모델 하이퍼 파라미터에 따른 예측률 비교
- 모델 재학습에 따른 예측값을 비교하여 더 좋은 모델을 production으로 변경하여 항상 가장 좋은 예측값을 가지는 추론 모델 유지
### Minio
- 생성 모델 관리
- MLflow와 연동하여 실험 모델을 저장
### Redis AI
- 인 메모리 데이터 베이스를 활용하여 모델 서빙 성능 향상
- prefect에서 생성한 모델 혹은 하이퍼 파라미터를 새로 지정하여 생성된 모델이 최신 모델과 비교하여 더 좋다면 RedisAI에 저장하고, 아니면 저장하지 않는다
- FastAPI 서버 요청에 따라 저장된 모델을 호출한다.
### Postgresql
- 예측 모델 생성 자료 수집
- 캐글에서 받은 데이터를 sqlalchemy를 이용하여 postgresql에 저장
- <https://www.kaggle.com/datasets/mathsian/hotel-bookings>
### Prefect
- ML 파이프라인 구축
- 대시 보드를 통한 모델 및 스케쥴 관리
- Cloud hook을 이용하여 문제 발생시 즉각 대응
### Locust
- 무작위 요청을 통해 서버 부하 테스트